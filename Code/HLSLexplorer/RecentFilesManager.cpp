#include "PCH.h"
#include "RecentFilesManager.h"
#include <fstream>

CRecentFilesManager::CRecentFilesManager()
	: m_nNumRecentFiles(0)
{
	m_recentFileList.reserve(MAX_RECENT_FILES);
}

//-----------------------------------------------------------------------------
CRecentFilesManager::~CRecentFilesManager()
{
	m_recentFileList.clear();
	m_nNumRecentFiles = 0;
}

//-----------------------------------------------------------------------------
unsigned int CRecentFilesManager::Count() const
{
	return m_nNumRecentFiles;
}

//-----------------------------------------------------------------------------
bool CRecentFilesManager::Empty() const
{
	return m_recentFileList.empty();
}

//-----------------------------------------------------------------------------
void CRecentFilesManager::AddRecent( const std::string& recentFile )
{
	auto it = std::find(std::begin(m_recentFileList), std::end(m_recentFileList), recentFile);
	if ( it != std::end(m_recentFileList) )
	{
		// if it's already within list, remove it from current place...
		m_recentFileList.erase(it);

		// ...and move it to the top
		m_recentFileList.insert( std::begin(m_recentFileList), recentFile );
	}
	else
	{
		// new item, insert to the top
		m_recentFileList.insert( std::begin(m_recentFileList), recentFile );
		m_nNumRecentFiles++;
	}

	// If too many elements, remove the last one.
	if (m_nNumRecentFiles > MAX_RECENT_FILES)
	{
		m_recentFileList.erase( std::end(m_recentFileList) - 1 );
		m_nNumRecentFiles = MAX_RECENT_FILES;
	}
}

//-----------------------------------------------------------------------------
void CRecentFilesManager::EraseByIndex( unsigned int index )
{
	const unsigned int maxIndex = m_nNumRecentFiles - 1;
	if (index > maxIndex)
	{
		return;
	}

	m_recentFileList.erase( std::begin(m_recentFileList) + index );
	m_nNumRecentFiles--;
}

//-----------------------------------------------------------------------------
void CRecentFilesManager::ClearAll()
{
	m_recentFileList.clear();
	m_nNumRecentFiles = 0;
}

//-----------------------------------------------------------------------------
bool CRecentFilesManager::LoadFromFile( const std::string& file )
{
	std::ifstream fin( file );
	if (!fin.is_open())
	{
		return false;
	}

	std::string recentFilePath;

	while ( std::getline(fin, recentFilePath) )
	{
		m_recentFileList.push_back(recentFilePath);
		m_nNumRecentFiles++;
	}

	fin.close();

	return true;
}

//-----------------------------------------------------------------------------
bool CRecentFilesManager::SaveToFile( const std::string& file ) const
{
	std::ofstream fout;
	fout.open(file, std::ofstream::out | std::ofstream::trunc);
	if (!fout)
	{
		return false;
	}

	
	for (const auto& x : m_recentFileList )
	{
		fout << x << std::endl;
	}

	fout.close();

	return true;
}

//-----------------------------------------------------------------------------
const CRecentFilesManager::TVecString& CRecentFilesManager::RecentFiles() const
{
	return m_recentFileList;
}
